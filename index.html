<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Interactive Globe</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- Speed up first connections for textures & Firebase -->
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://www.gstatic.com" crossorigin>

  <style>
    body { margin:0; overflow:hidden; font-family:'Inter',sans-serif; background-color:#000000; }
    #globeViz { width:100vw; height:100vh; position:relative; z-index:2; }

    .ui-container { position:absolute; top:10px; right:10px; display:flex; align-items:center; gap:10px; z-index:1000; }

    .search-bar-container { position:relative; display:flex; flex-direction:column; width:250px; }
    #search-input { padding:8px 12px; border-radius:8px; border:1px solid #ccc; box-shadow:0 4px 6px rgba(0,0,0,0.1); }
    #search-results { list-style:none; padding:0; margin:0; position:absolute; top:100%; width:100%; background:#fff; border:1px solid #ccc; border-top:none; border-radius:0 0 8px 8px; max-height:200px; overflow-y:auto; display:none; z-index:1001; box-shadow:0 8px 16px rgba(0,0,0,0.2); }
    #search-results li { padding:8px 12px; cursor:pointer; border-bottom:1px solid #eee; font-size:14px; }
    #search-results li:hover { background:#f0f0f0; }

    .marker-container { display:flex; flex-direction:column; align-items:center; cursor:pointer; }
    .marker-icon { width:40px; height:40px; border-radius:50%; border:3px solid #fff; transition:transform .2s, box-shadow .2s; }
    .marker-icon:hover { transform:scale(1.1); box-shadow:0 0 10px rgba(255,255,255,.7); }
    .marker-label { margin-top:2px; color:#2fe0ff; font-size:14px; font-weight:bold; text-align:center; text-shadow:0 0 5px #000, 0 0 10px #000; pointer-events:none; }

    #loading-spinner { display:none; }

    /* Comets behind globe & UI */
    .comet { position:fixed; width:2px; height:2px; background:#fff; border-radius:50%; box-shadow:0 0 5px rgba(255,255,255,0.8), 0 0 15px #a0ffff; z-index:1; pointer-events:none; opacity:0; transform:translate(var(--start-x), var(--start-y)); animation:comet-fly var(--duration) linear var(--delay) infinite; }
    .comet::before { content:''; position:absolute; top:50%; left:50%; width:150px; height:1px; background:linear-gradient(to right, rgba(255,255,255,0), rgba(160,255,255,0.8)); transform:translate(-100%,-50%) rotate(45deg); transform-origin:100% 50%; opacity:0.6; }
    @keyframes comet-fly { 0%{ transform:translate(var(--start-x), var(--start-y)); opacity:0; } 5%{ opacity:1; } 95%{ opacity:1; } 100%{ transform:translate(var(--end-x), var(--end-y)); opacity:0; } }

    /* ===== EMBED MODE: globe-only, transparent background ===== */
    html.embed body { background: transparent !important; }
    html.embed #globeViz { background: transparent !important; }
    html.embed .ui-container,
    html.embed .modal,
    html.embed #uploadControls,
    html.embed #search-results { display: none !important; }
    html.embed .comet { display: none !important; }
  </style>
</head>
<body>

  <div id="globeViz"></div>

  <div class="ui-container">
    <div class="search-bar-container">
      <input type="text" id="search-input" placeholder="Search location..." class="form-control">
      <ul id="search-results"></ul>
    </div>

    <div id="uploadControls">
      <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#uploadModal" title="Upload CSV file">
        <i class="fas fa-file-upload"></i> Upload
      </button>
    </div>
  </div>

  <!-- Upload CSV Modal -->
  <div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="uploadModalLabel">Upload Locations (CSV)</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p>Select a CSV file. Make sure it has the columns <strong>city</strong>, <strong>lat</strong>, and <strong>lng</strong> (optional: <strong>country</strong>).</p>
          <input type="file" class="form-control" id="csvFile" accept=".csv">
          <div id="statusMessage" class="mt-3">Ready to upload.</div>
        </div>
        <div class="modal-footer">
          <span id="loading-spinner" class="spinner-border spinner-border-sm me-2" role="status" aria-hidden="true"></span>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="uploadBtn">Upload</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Pin Modal -->
  <div class="modal fade" id="pinningModal" tabindex="-1" aria-labelledby="pinningModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="pinningModalLabel">Pin / Unpin Location</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p id="pinningModalText">Do you want to toggle the pin status?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" id="togglePinBtn">Pin</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Choose Brand Modal -->
  <div class="modal fade" id="brandModal" tabindex="-1" aria-labelledby="brandModalLabel" aria-hidden="true" data-bs-backdrop="static" data-bs-keyboard="false">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="brandModalLabel">Choose Brand for City</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <p id="brandModalText">Which brand should be shown for this city?</p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" id="chooseUnpinBtn" style="display:none">Unpin</button>
          <button type="button" class="btn btn-dark" id="chooseFederationBtn">Federation</button>
          <button type="button" class="btn btn-primary" id="chooseAcademyBtn">Academy</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/globe.gl"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.5/dist/sweetalert2.min.js"></script>

  <script type="module" src="./firebase.js"></script>
  <script type="module" src="./main.js"></script>
  <!-- background-effects.js is imported inside main.js -->
</body>
</html>
